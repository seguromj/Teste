
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Cupom Profissional com Produtos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #e9ecef; color: #333; }
        .container { max-width: 600px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        h2, h3 { text-align: center; color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px; }
        input { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 6px; }
        
        .produto-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .produto-row input[type="text"] { flex: 3; }
        .produto-row input[type="number"] { flex: 1; }

        button { width: 100%; padding: 12px; margin-top: 10px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; text-transform: uppercase; }
        .btn-add { background-color: #f39c12; color: white; margin-bottom: 20px; }
        .btn-gerar { background-color: #2ecc71; color: white; }
        .btn-pdf { background-color: #34495e; color: white; display: none; margin-top: 20px; }

        /* Estilo do Cupom */
        #area-cupom { 
            margin-top: 30px; 
            padding: 20px; 
            background: #fff; 
            display: none; 
            font-family: 'Courier New', Courier, monospace;
            color: #000;
            border: 1px solid #ddd;
            width: 320px;
            margin-left: auto;
            margin-right: auto;
        }

        .cupom-header { text-align: center; margin-bottom: 10px; }
        .divisor { border-top: 1px dashed #000; margin: 10px 0; }
        
        table { width: 100%; font-size: 13px; border-collapse: collapse; }
        th { text-align: left; border-bottom: 1px solid #000; }
        .text-right { text-align: right; }
        .total-row { font-size: 16px; font-weight: bold; margin-top: 10px; display: flex; justify-content: space-between; }
        
        .rodape { text-align: center; margin-top: 20px; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Emissor de Cupom</h2>
    
    <div class="form-group">
        <label>Nome do Cliente:</label>
        <input type="text" id="nome" placeholder="Nome completo">
    </div>

    <div class="form-group">
        <label>CPF:</label>
        <input type="text" id="cpf" placeholder="000.000.000-00">
    </div>

    <div class="form-group">
        <label>WhatsApp / E-mail:</label>
        <div style="display: flex; gap: 10px;">
            <input type="text" id="whatsapp" placeholder="WhatsApp">
            <input type="email" id="email" placeholder="E-mail">
        </div>
    </div>

    <div class="divisor"></div>
    <h3>Produtos</h3>
    <div id="lista-inputs-produtos">
        <div class="produto-row">
            <input type="text" class="p-nome" placeholder="Nome do produto">
            <input type="number" class="p-preco" placeholder="Preço (0.00)" step="0.01">
        </div>
    </div>
    <button class="btn-add" onclick="adicionarCampoProduto()">+ Adicionar Outro Produto</button>

    <button class="btn-gerar" onclick="gerarCupom()">Visualizar Nota</button>

    <div id="area-cupom">
        <div class="cupom-header">
            <strong>RECIBO DE VENDA</strong><br>
            <small>Não possui valor fiscal</small>
        </div>

        <div class="divisor"></div>
        <div style="font-size: 12px;">
            <strong>DATA:</strong> <span id="view-data"></span><br>
            <strong>CLIENTE:</strong> <span id="view-nome"></span><br>
            <strong>CPF:</strong> <span id="view-cpf"></span>
        </div>
        <div class="divisor"></div>

        <table>
            <thead>
                <tr>
                    <th>ITEM</th>
                    <th class="text-right">VALOR</th>
                </tr>
            </thead>
            <tbody id="tabela-itens">
                </tbody>
        </table>

        <div class="divisor"></div>
        <div class="total-row">
            <span>TOTAL:</span>
            <span id="view-total">R$ 0,00</span>
        </div>

        <div class="rodape">
            <strong>OBRIGADO PELA PREFERÊNCIA!</strong>
        </div>
    </div>

    <button id="btn-download" class="btn-pdf" onclick="baixarPDF()">Baixar PDF do Cupom</button>
</div>

<script>
    function adicionarCampoProduto() {
        const container = document.getElementById('lista-inputs-produtos');
        const novaLinha = document.createElement('div');
        novaLinha.className = 'produto-row';
        novaLinha.innerHTML = `
            <input type="text" class="p-nome" placeholder="Nome do produto">
            <input type="number" class="p-preco" placeholder="Preço (0.00)" step="0.01">
        `;
        container.appendChild(novaLinha);
    }

    function gerarCupom() {
        const nome = document.getElementById('nome').value;
        if(!nome) { alert("Informe o nome do cliente."); return; }

        // Dados do Cliente
        document.getElementById('view-nome').innerText = nome;
        document.getElementById('view-cpf').innerText = document.getElementById('cpf').value || "ISENTO";
        document.getElementById('view-data').innerText = new Date().toLocaleString('pt-BR');

        // Processar Produtos
        const nomes = document.getElementsByClassName('p-nome');
        const precos = document.getElementsByClassName('p-preco');
        const tabela = document.getElementById('tabela-itens');
        tabela.innerHTML = "";
        let total = 0;

        for (let i = 0; i < nomes.length; i++) {
            if (nomes[i].value && precos[i].value) {
                const valor = parseFloat(precos[i].value);
                total += valor;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${nomes[i].value.toUpperCase()}</td>
                    <td class="text-right">R$ ${valor.toFixed(2)}</td>
                `;
                tabela.appendChild(tr);
            }
        }

        document.getElementById('view-total').innerText = "R$ " + total.toFixed(2);
        
        // Mostrar Cupom
        document.getElementById('area-cupom').style.display = 'block';
        document.getElementById('btn-download').style.display = 'block';
    }

    function baixarPDF() {
        const elemento = document.getElementById('area-cupom');
        const nomeCli = document.getElementById('nome').value;

        const opcoes = {
            margin:       0.2,
            filename:     'cupom_' + nomeCli + '.pdf',
            image:        { type: 'jpeg', quality: 1.0 },
            html2canvas:  { scale: 3 },
            jsPDF:        { unit: 'in', format: [3.5, 6], orientation: 'portrait' }
        };

        html2pdf().set(opcoes).from(elemento).save();
    }
</script>

</body>
</html>
