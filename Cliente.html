
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDV Nuance - Fluxo em Tempo Real</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --primary: #2563eb; --success: #16a34a; --bg: #f1f5f9; --whatsapp: #25d366; --purple: #8b5cf6; --dark: #0f172a; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); margin: 0; padding: 0; overflow: hidden; }
        
        .main-wrapper { display: flex; flex-direction: column; height: 100vh; }
        .top-bar { background: var(--dark); color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
        
        .pdv-container { display: flex; flex: 1; overflow: hidden; padding: 15px; gap: 15px; }
        
        /* Lateral: Pasta de Pedidos Capturados */
        .sidebar-pedidos { width: 280px; background: white; border-radius: 12px; display: flex; flex-direction: column; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .sidebar-header { background: var(--purple); color: white; padding: 15px; border-radius: 12px 12px 0 0; font-weight: bold; text-align: center; font-size: 14px; }
        .lista-captura { flex: 1; overflow-y: auto; padding: 10px; }
        
        .card-pedido { background: #f8fafc; border: 2px solid #e2e8f0; padding: 12px; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: 0.3s; animation: slideIn 0.3s ease; }
        .card-pedido:hover { border-color: var(--purple); transform: scale(1.02); }
        .card-pedido.novo { border-color: var(--whatsapp); background: #f0fff4; animation: pulse 1.5s infinite; }
        .card-pedido .nome { font-weight: bold; font-size: 13px; display: block; color: var(--dark); }
        .card-pedido .hora { font-size: 11px; color: #64748b; }

        /* Painel Central: Formul√°rio de Edi√ß√£o */
        .panel-center { flex: 1; background: white; border-radius: 12px; padding: 20px; overflow-y: auto; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .section-title { font-size: 11px; font-weight: 700; text-transform: uppercase; color: #64748b; margin: 15px 0 10px; border-left: 3px solid var(--primary); padding-left: 8px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        input, textarea, select { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; margin-bottom: 8px; box-sizing: border-box; font-size: 14px; }
        
        .btn { border: none; border-radius: 8px; padding: 12px; font-weight: 600; cursor: pointer; width: 100%; margin-bottom: 8px; text-transform: uppercase; color: white; }
        .btn-gerar { background: var(--primary); padding: 18px; font-size: 16px; margin-top: 10px; }
        .btn-wpp { background: var(--whatsapp); font-size: 12px; }

        /* Painel Direito: Cupom */
        .panel-right { width: 320px; background: #cbd5e1; border-radius: 12px; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        #area-cupom { width: 80mm; background: white; padding: 8mm; display: none; font-family: 'Courier New', monospace; box-shadow: 0 10px 20px rgba(0,0,0,0.1); color: black; }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(37, 211, 102, 0); } 100% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }

        @media (max-width: 900px) {
            body { overflow-y: auto; }
            .pdv-container { flex-direction: column; height: auto; }
            .sidebar-pedidos, .panel-center, .panel-right { width: 100%; height: auto; }
        }
    </style>
</head>
<body>

<div class="main-wrapper">
    <div class="top-bar">
        <h2 style="margin:0; font-size: 18px;">NUANCE PDV <span id="status" style="font-size: 10px; color: #25d366;">‚óè ONLINE</span></h2>
        <div id="radar-loader" style="font-size: 11px; color: #94a3b8;">Radar: Buscando...</div>
    </div>

    <div class="pdv-container">
        <div class="sidebar-pedidos">
            <div class="sidebar-header">üì• PEDIDOS DA PLANILHA</div>
            <div class="lista-captura" id="lista-pedidos">
                <p style="text-align:center; color:#94a3b8; font-size:12px; margin-top:30px;">Aguardando novos pedidos...</p>
            </div>
        </div>

        <div class="panel-center">
            <div class="section-title">Dados do Cliente</div>
            <div class="grid">
                <input type="text" id="nome" placeholder="Nome Completo">
                <input type="text" id="whatsapp" placeholder="WhatsApp">
            </div>
            <div class="grid">
                <input type="text" id="rua" placeholder="Rua/Avenida">
                <input type="text" id="numero" placeholder="N¬∫/QD/LT">
            </div>
            <div class="grid">
                <input type="text" id="bairro" placeholder="Bairro">
                <input type="text" id="cep" placeholder="CEP">
            </div>
            <input type="text" id="complemento" placeholder="Ponto de Refer√™ncia / Complemento">

            <div class="section-title">Itens do Pedido</div>
            <textarea id="produtos-texto" placeholder="Lista de produtos..." style="height: 100px;"></textarea>
            
            <div class="grid">
                <input type="text" id="valor-total" placeholder="Valor Total (R$)">
                <input type="text" id="pagamento" placeholder="Forma de Pagamento">
            </div>

            <div class="section-title">Notifica√ß√µes WhatsApp</div>
            <div class="grid">
                <button class="btn btn-wpp" onclick="notificar('preparo')">üë®‚Äçüç≥ Preparo</button>
                <button class="btn btn-wpp" onclick="notificar('entrega')">üöÄ Entrega</button>
            </div>
            
            <button class="btn btn-gerar" onclick="gerarCupomFinal()">‚ú® FINALIZAR E GERAR CUPOM</button>
        </div>

        <div class="panel-right">
            <div id="area-cupom">
                <center>
                    <h2 style="margin:0">NUANCE DRINKS</h2>
                    <small>Comprovante de Pedido</small>
                </center>
                <div style="border-top: 1px dashed #000; margin: 10px 0;"></div>
                <div id="cupom-conteudo" style="font-size: 12px; line-height: 1.4;"></div>
                <div style="border-top: 1px dashed #000; margin: 10px 0;"></div>
                <div id="cupom-total" style="font-weight: bold; font-size: 15px; text-align: right;"></div>
                <div style="text-align: center; margin-top: 20px; font-size: 11px; font-style: italic;">
                    "O Senhor √© meu pastor, nada me faltar√°."
                </div>
            </div>
            <button class="btn" style="background:var(--dark); width:200px; margin-top:15px; display:none;" id="btn-imprimir" onclick="window.print()">üñ®Ô∏è IMPRIMIR AGORA</button>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // CONFIGURA√á√ÉO: COLE SEU LINK /EXEC ABAIXO
    // ==========================================
    const URL_SCRIPT = "SEU_LINK_AQUI"; 

    let ultimoPedidoID = ""; 

    // RADAR: Verifica a planilha a cada 10 segundos
    async function radarNuance() {
        if(URL_SCRIPT === "SEU_LINK_AQUI") return;
        
        document.getElementById('radar-loader').innerText = "Radar: Sincronizando...";
        
        try {
            const response = await fetch(URL_SCRIPT);
            const pedido = await response.json();

            // Verifica se o pedido √© realmente novo (baseado no nome e hora)
            let idAtual = pedido.nome + pedido.data_hora;
            
            if (idAtual !== ultimoPedidoID) {
                ultimoPedidoID = idAtual;
                adicionarPedidoNaPasta(pedido);
                tocarBip();
            }
            document.getElementById('radar-loader').innerText = "Radar: Aguardando...";
        } catch (error) {
            document.getElementById('radar-loader').innerText = "Radar: Erro de conex√£o";
        }
    }

    // Inicia o radar
    setInterval(radarNuance, 10000);

    function adicionarPedidoNaPasta(p) {
        const lista = document.getElementById('lista-pedidos');
        
        // Remove a mensagem de "Aguardando" se for o primeiro pedido
        if(lista.innerText.includes("Aguardando")) lista.innerHTML = "";

        const card = document.createElement('div');
        card.className = 'card-pedido novo';
        card.onclick = () => preencherPDV(p, card);
        card.innerHTML = `
            <span style="color:var(--success); font-size:9px; font-weight:bold;">‚óè NOVO RECEBIDO</span>
            <span class="nome">${p.nome}</span>
            <span class="hora">${p.data_hora}</span>
        `;
        lista.prepend(card);
    }

    function preencherPDV(p, elemento) {
        document.getElementById('nome').value = p.nome || "";
        document.getElementById('whatsapp').value = p.whatsapp || "";
        document.getElementById('rua').value = p.rua || "";
        document.getElementById('numero').value = p.numero || "";
        document.getElementById('bairro').value = p.bairro || "";
        document.getElementById('cep').value = p.cep || "";
        document.getElementById('complemento').value = p.complemento || "";
        document.getElementById('produtos-texto').value = (p.pedido || "").replace(/(\d+x)/g, '\n$1').trim();
        document.getElementById('valor-total').value = p.total || "";
        document.getElementById('pagamento').value = p.pagamento || "";
        
        // Tira o efeito de "piscar" ap√≥s clicar
        elemento.classList.remove('novo');
        alert("Pedido de " + p.nome + " carregado!");
    }

    function gerarCupomFinal() {
        const nome = document.getElementById('nome').value;
        if(!nome) return alert("Selecione ou digite um pedido!");

        const dados = `
            <b>CLIENTE:</b> ${nome.toUpperCase()}<br>
            <b>CONTATO:</b> ${document.getElementById('whatsapp').value}<br>
            <b>ENDERE√áO:</b> ${document.getElementById('rua').value}, ${document.getElementById('numero').value}<br>
            <b>BAIRRO:</b> ${document.getElementById('bairro').value}<br>
            <b>REF:</b> ${document.getElementById('complemento').value}<br>
            <br>
            <b>ITENS DO PEDIDO:</b><br>
            ${document.getElementById('produtos-texto').value.replace(/\n/g, '<br>')}
            <br>
            <b>FORMA DE PAGAMENTO:</b> ${document.getElementById('pagamento').value}
        `;
        
        document.getElementById('cupom-conteudo').innerHTML = dados;
        document.getElementById('cupom-total').innerHTML = "TOTAL A PAGAR: R$ " + document.getElementById('valor-total').value;
        document.getElementById('area-cupom').style.display = 'block';
        document.getElementById('btn-imprimir').style.display = 'block';
    }

    function notificar(status) {
        const nome = document.getElementById('nome').value;
        const tel = document.getElementById('whatsapp').value.replace(/\D/g, '');
        let msg = status === 'preparo' ? `Ol√° ${nome}, seu pedido Nuance j√° est√° em preparo! üë®‚Äçüç≥` : `Boa not√≠cia ${nome}! Seu pedido saiu para entrega. üöÄ`;
        if(tel) window.open(`https://api.whatsapp.com/send?phone=55${tel}&text=${encodeURIComponent(msg)}`);
    }

    function tocarBip() {
        const context = new (window.AudioContext || window.webkitAudioContext)();
        const osc = context.createOscillator();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(880, context.currentTime);
        osc.connect(context.destination);
        osc.start();
        osc.stop(context.currentTime + 0.2);
    }
</script>

</body>
</html>
