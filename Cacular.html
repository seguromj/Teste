<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Links de Pagamento - An√°lise de Cobertura</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        input[type="text"] {
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 10px 15px;
            background-color: #28a745; 
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        button:hover {
            background-color: #1e7e34;
        }
        #resultado-container {
            margin-top: 25px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            text-align: center;
        }
        /* Destaque para o contador de links */
        #totalLinksUnicos {
            font-size: 1.2em;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #e9ecef;
            border-left: 5px solid #007bff;
        }
        /* DESTAQUE PARA LINKS √öNICOS (VERDE) */
        .unique-row {
            background-color: #6AAB6A; /* Fundo verde claro */
            font-weight: bold;
        }
        .unique-row .valor {
            color: #721c24; /* Texto do valor em vermelho escuro */
            font-weight: bold;
            font-size: 1.1em;
        }
        /* DESTAQUE PARA LINKS REPETIDOS (AMARELO) */
        .duplicate-row {
            background-color: #fff3cd; /* Fundo amarelo claro */
            color: #856404;
        }
        .header-total {
            background-color: #007bff;
            color: white;
            text-align: center;
        }
        /* Cor de fundo para as c√©lulas de n√≠vel */
        .nivel-1 { background-color: #d1ecf1; }
        .nivel-2 { background-color: #c3e6cb; }
        .nivel-3 { background-color: #ffe8a1; }
        .nivel-4 { background-color: #f0c2c2; }


        
        /* Estilo para a se√ß√£o de simula√ß√£o */
        #simulacao {
            margin-top: 40px;
            padding: 20px;
            border: 2px dashed #007bff;
            border-radius: 8px;
        }
        /* Bloco de instru√ß√µes */
        .instrucoes {
            margin: 20px 0;
            padding: 15px;
            border-left: 5px solid #007bff;
            background-color: #f8f9fa;
        }
        .instrucoes h4 {
            margin-top: 0;
            color: #007bff;
        }
    </style>
</head>
<body>

    <h2>Calculadora de Links de Pagamento</h2>
    
    <div class="instrucoes">
        <h4>Regras de Combina√ß√£o e Links √önicos</h4>
        <p>A calculadora gera todas as combina√ß√µes de valores dos seus produtos, de 1 item at√© **4 itens (N√≠vel 4)**.</p>
        <ul>
            <li>üü¢ Linhas em VERDE (Status: NOVO): Indica que o valor do link <strong>N√ÉO EXISTIA</strong> e deve ser criado para cobrir esta soma.</li>
            <li>üü° Linhas em AMARELO (Status: REPETIDO): Indica que o valor do link <strong>J√Å EXISTIA</strong>  (foi coberto por uma combina√ß√£o anterior mais simples ou diferente). Voc√™ *N√ÉO* precisa criar este link.</li>
            <li>Observa√ß√£o: Para cada valor √∫nico, a tabela mostra apenas a primeira combina√ß√£o que o gerou, garantindo que voc√™ n√£o crie links repetidos.</li>
       </ul>
    </div>
    <div>
        <span class="nivel-1">‚ÄãN√≠vel 1: Valor Base (1 Produto)</apan><br>
        <span class="nivel-2">‚ÄãN√≠vel 2: Valor Duplo (2 Produtos)</span><br>
        <span class="nivel-3">‚ÄãN√≠vel 3: Valor Triplo (3 Produtos)</span><br>
        <span class="nivel-4">‚Äã‚ÄãN√≠vel 4: Valor Qu√°druplo (4 Produtos)</span>
    </div>
    <h3>1. Produtos Atuais</h3>
    <p>Insira os **valores √∫nicos** dos seus produtos atuais (separados por v√≠rgula):</p>
    <input type="text" id="valoresInput" value="6, 8, 10, 15, 18, 20" style="width: 350px;">
    <button onclick="calcularLinks()">Calcular Base</button>

    <div id="resultado-container">
        <div id="totalLinksUnicos"></div>
        <div id="tabelaResultado"></div>
    </div>
    
    <hr>

    <div id="simulacao">
        <h3>2. Simula√ß√£o: Adicionar Novo Produto</h3>
        <p>Valor do novo produto para simular (ex: 23):</p>
        <input type="text" id="novoValorInput" style="width: 150px;">
        <button onclick="calcularNovoValor()">Simular Novo Link</button>
        
        <p id="totalNovosLinksCriados" style="margin-top: 15px; font-weight: bold;"></p>
        
        <p>Tabela de Combina√ß√µes do **NOVO Cat√°logo** (Base + Novo Produto):</p>
        <div id="tabelaNovosLinks"></div>
    </div>

    <script>
        // Vari√°veis globais
        let valoresBaseSet = new Set();
        let valoresBase = [];
        const MAX_ITENS = 4;

        // Fun√ß√£o utilit√°ria para gerar todas as combina√ß√µes (Recursiva)
        function gerarCombinacoes(valores, maxItens) {
            const somas = [];
            
            function combinacaoRecursiva(indiceInicial, itensAtuais, somaAtual) {
                const nivel = itensAtuais.length;
                
                if (nivel > 0 && nivel <= maxItens) {
                    const valor = parseFloat(somaAtual.toFixed(2));
                    const formula = itensAtuais.map(v => `R$ ${v.toFixed(2).replace('.', ',')}`).join(' + ');
                    
                    somas.push({
                        valor: valor,
                        formula: formula,
                        nivel: nivel
                    });
                }
                
                if (nivel === maxItens) {
                    return;
                }

                for (let i = indiceInicial; i < valores.length; i++) {
                    combinacaoRecursiva(i, [...itensAtuais, valores[i]], somaAtual + valores[i]);
                }
            }
            
            combinacaoRecursiva(0, [], 0);
            return somas;
        }

        /**
         * Processa as somas para definir unicidade (VERMELHO/AMARELO) e filtra para exibir apenas uma f√≥rmula por valor.
         * @param {Array} somasGeradas - Todas as somas calculadas.
         * @param {Set} valoresJaVistos - Os valores que J√Å s√£o cobertos (Set Base). 
         * @returns {Object} Contendo {resultadosFinais, totalNovos, setTotal}.
         */
        function processarSomas(somasGeradas, valoresJaVistos) {
            const todasAsSomas = [];
            const setTotal = new Set(valoresJaVistos); 
            const linksUnicosDestaRodada = new Set();
            const valoresExibidos = new Set(); 

            somasGeradas.forEach(soma => {
                const isUnique = !valoresJaVistos.has(soma.valor);
                
                // 1. Contagem e Atualiza√ß√£o do SetTotal
                if (isUnique && !setTotal.has(soma.valor)) {
                    setTotal.add(soma.valor);
                    linksUnicosDestaRodada.add(soma.valor);
                }

                todasAsSomas.push({...soma, isUnique: isUnique});
            });

            // 2. Ordena e Filtra para Exibi√ß√£o: Garante apenas uma linha (combina√ß√£o) por VALOR √öNICO/REPETIDO.
            const resultadosOrdenados = todasAsSomas.sort((a, b) => a.valor - b.valor);

            const resultadosFinais = resultadosOrdenados.filter(item => {
                if (valoresExibidos.has(item.valor)) {
                    return false;
                }
                
                valoresExibidos.add(item.valor);
                return true;
            });
            
            return { 
                resultadosFinais, 
                totalNovos: linksUnicosDestaRodada.size, 
                setTotal: setTotal 
            };
        }

        /**
         * Constr√≥i a tabela HTML.
         */
        function construirTabela(resultadosFinais, titulo, divId) {
            let html = '<table>';
            const colSpan = 4; // N√≠vel + Valor + F√≥rmula + Status

            html += `<thead><tr><th colspan="${colSpan}" class="header-total">${titulo}</th></tr>`;
            html += '<tr><th>N√≠vel</th><th>Valor do Link (R$)</th><th>F√≥rmula da Combina√ß√£o</th><th>Status</th></tr></thead>';
            html += '<tbody>';

            resultadosFinais.forEach(item => {
                const className = item.isUnique ? 'unique-row' : 'duplicate-row'; 
                const statusText = item.isUnique ? '‚ö†Ô∏è NOVO - CRIAR LINK' : '‚úÖ VALOR REPETIDO'; 
                
                html += `<tr class="${className}">`;
                html += `<td class="nivel-${item.nivel}" style="text-align:center;">${item.nivel}</td>`;
                html += `<td><span class="valor">R$ ${item.valor.toFixed(2).replace('.', ',')}</span></td>`;
                html += `<td>${item.formula}</td>`; 
                html += `<td>${statusText}</td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            document.getElementById(divId).innerHTML = html;
        }

        // ----------------------------------------------------------------------
        // C√ÅLCULO BASE
        // ----------------------------------------------------------------------
        function calcularLinks() {
            const input = document.getElementById('valoresInput').value;
            valoresBase = input.split(',')
                .map(v => parseFloat(v.trim()))
                .filter(v => !isNaN(v) && v > 0)
                .sort((a, b) => a - b);

            if (valoresBase.length === 0) {
                document.getElementById('tabelaResultado').innerHTML = '<p>Por favor, insira valores v√°lidos.</p>';
                document.getElementById('totalLinksUnicos').innerHTML = 'Total de Links √önicos para Criar: **0**';
                valoresBaseSet = new Set();
                return;
            }

            const somasGeradas = gerarCombinacoes(valoresBase, MAX_ITENS);
            
            // Set de valores j√° vistos √© VAZIO para o c√°lculo base
            const { resultadosFinais, setTotal } = processarSomas(somasGeradas, new Set());
            valoresBaseSet = setTotal; 

            document.getElementById('totalLinksUnicos').innerHTML = `Total de Links √önicos a Criar: **${valoresBaseSet.size}**`;
            construirTabela(resultadosFinais, `DETALHE DAS ${valoresBaseSet.size} COMBINA√á√ïES BASE`, 'tabelaResultado');
            
            // Limpa a simula√ß√£o ao recalcular a base
            document.getElementById('totalNovosLinksCriados').innerHTML = '';
            document.getElementById('tabelaNovosLinks').innerHTML = '';
        }

        // ----------------------------------------------------------------------
        // SIMULA√á√ÉO
        // ----------------------------------------------------------------------
        function calcularNovoValor() {
            const novoValorStr = document.getElementById('novoValorInput').value;
            const novoValor = parseFloat(novoValorStr.trim());

            if (valoresBaseSet.size === 0) {
                alert("Por favor, calcule a base de produtos primeiro.");
                return;
            }
            if (isNaN(novoValor) || novoValor <= 0) {
                alert("Por favor, insira um valor v√°lido para o novo produto.");
                return;
            }
            
            const novaListaValores = [...valoresBase, novoValor].sort((a, b) => a - b);
            const novasSomasGeradas = gerarCombinacoes(novaListaValores, MAX_ITENS);
            
            // O Set de compara√ß√£o √© o Set Base ORIGINAL.
            const { resultadosFinais: resultadosSimulacao, totalNovos, setTotal } = processarSomas(novasSomasGeradas, valoresBaseSet);

            construirTabela(resultadosSimulacao, `TODAS AS COMBINA√á√ïES DO NOVO CAT√ÅLOGO (${setTotal.size} LINKS √öNICOS)`, 'tabelaNovosLinks');

            document.getElementById('totalNovosLinksCriados').innerHTML = 
                `O novo produto criaria **${totalNovos}** links de pagamento √∫nicos adicionais, elevando o total de links para **${setTotal.size}**.`
                
        }

        // Executa o c√°lculo inicial ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', calcularLinks);
    </script>

</body>
</html>

